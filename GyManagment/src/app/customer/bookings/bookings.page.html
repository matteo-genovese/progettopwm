<app-header 
  title="Le Mie Prenotazioni"
  [backHref]="'customer/dashboard'">
</app-header>

<ion-content [fullscreen]="true" class="ion-padding">

  <!-- Refresher mobile -->
  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>
  
  <!-- Selezione tab -->
  <ion-segment [(ngModel)]="selectedTab">
    <ion-segment-button value="upcoming">
      <ion-label>Prossimi</ion-label>
    </ion-segment-button>
    <ion-segment-button value="past">
      <ion-label>Passati</ion-label>
    </ion-segment-button>
  </ion-segment>

  <!-- Caricamento prenotazioni -->
  @if (isLoading) {
    <app-loading-spinner 
      [message]="'Caricamento prenotazioni...'">
    </app-loading-spinner>
  }

  @if (!isLoading) {
    <div [ngSwitch]="selectedTab">

      <!-- Tab "PROSSIMI" -->
      @switch (selectedTab) {
        @case ('upcoming') {
          <!-- Mostrato se non ci sono prenotazioni future -->
          @if (upcomingBookings.length === 0) {
            <ion-card>
              <app-empty-state 
                icon="calendar-outline"
                title="Nessuna prenotazione futura"
                description="Prenota una sessione con un trainer per visualizzarla qui"
                buttonText="Trova un trainer"
                (buttonClicked)="goToTrainers()">
              </app-empty-state>
            </ion-card>
          }

          <!-- Mostrato se ci sono prenotazioni future -->
          @if (upcomingBookings.length > 0) {
            <div class="bookings-grid">
              @for (booking of upcomingBookings; track booking.id) {
                <div class="booking-card">
                  <!-- Card prenotazione -->
                  <ion-card-header>
                    <ion-card-title>{{ booking.trainer_name }}</ion-card-title>
                    @if (booking.specialization) {
                      <ion-card-subtitle>{{ booking.specialization }}</ion-card-subtitle>
                    }
                  </ion-card-header>
                  <ion-card-content>
                    <div class="booking-details">
                      <p>
                        <ion-icon name="calendar-outline"></ion-icon>
                        {{ booking.start_time | date:'EEEE, d MMMM yyyy' }}
                      </p>
                      <p>
                        <ion-icon name="time-outline"></ion-icon>
                        {{ booking.adjustedStartTimeOnly }} - {{ booking.adjustedEndTimeOnly }}
                      </p>
                    </div>
                  </ion-card-content>
                </div>
              }
            </div>
          }
        }

        <!-- Tab "PASSATI" -->
        @case ('past') {
          <!-- Mostrato se non ci sono prenotazioni passate -->
          @if (pastBookings.length === 0) {
            <ion-card>
              <app-empty-state 
                icon="time-outline"
                title="Nessuna prenotazione passata"
                description="Le prenotazioni passate saranno visualizzate qui">
              </app-empty-state>
            </ion-card>
          }

          <!-- Mostrato se ci sono prenotazioni passate -->
          @if (pastBookings.length > 0) {
            <div class="bookings-grid">
              @for (booking of pastBookings; track booking.id) {
                <div class="booking-card">
                  <!-- Card prenotazione -->
                  <ion-card-header>
                    <ion-card-title>{{ booking.trainer_name }}</ion-card-title>
                    @if (booking.specialization) {
                      <ion-card-subtitle>{{ booking.specialization }}</ion-card-subtitle>
                    }
                  </ion-card-header>
                  <ion-card-content>
                    <div class="booking-details">
                      <p>
                        <ion-icon name="calendar-outline"></ion-icon>
                        {{ booking.start_time | date:'EEEE, d MMMM yyyy' }}
                      </p>
                      <p>
                        <ion-icon name="time-outline"></ion-icon>
                        {{ booking.adjustedStartTimeOnly }} - {{ booking.adjustedEndTimeOnly }}
                      </p>
                    </div>

                    <!-- Tasto valutazione -->
                    @if (!booking.rated) {
                      <ion-button expand="block" (click)="rateTrainer(booking.trainer_id)">
                        <ion-icon name="star-outline" slot="start"></ion-icon>
                        Valuta Trainer
                      </ion-button>
                    }
                  </ion-card-content>
                </div>
              }
            </div>
          }
        }
      }
    </div>
  }
</ion-content>
