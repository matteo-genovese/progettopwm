<app-header 
  title="Dashboard Cliente"
  [backHref]="'.'">
</app-header>

<ion-content [fullscreen]="true" class="ion-padding">
  
  <!-- Refresher mobile -->
  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <!-- Sezione di benvenuto -->
  @if (userData) {
    <div class="welcome-section">
      <h1>Benvenuto, {{ userData.full_name || userData.username }}</h1>
      <p>Gestisci i tuoi allenamenti e monitora i tuoi progressi</p>
    </div>
  }

  <!-- Sezione Prossimi Allenamenti -->
  <ion-card class="ion-card-dashboard">

    <ion-card-header>
      <ion-card-title>
        <ion-icon name="calendar-outline" color="primary"></ion-icon>
        Prossimi Allenamenti <small>(max 9)</small>
      </ion-card-title>
    </ion-card-header>
    
    <ion-card-content>

      @if (isLoading) {
        <div class="loading-placeholder">
          <app-loading-spinner [message]="'Caricamento dashboard...'"></app-loading-spinner>
        </div>
      }

      <!-- Mostrato se ci sono allenamenti prenotati -->
      @if (!isLoading && upcomingBookings.length > 0) {
        <div class="booking-container tall">
          @for (booking of upcomingBookings.slice(0, 9); track booking.id) {
            <div class="booking-item">
              <h2>{{ booking.trainer_name }}</h2>
              <p>
                <ion-icon name="calendar-outline"></ion-icon>
                {{ booking.adjustedStartDate }}
              </p>
              <p>
                <ion-icon name="time-outline"></ion-icon>
                {{ booking.adjustedStartTimeOnly }} - {{ booking.adjustedEndTimeOnly }}
              </p>
              @if (booking.specialization) {
                <p>
                  <ion-icon name="fitness-outline"></ion-icon>
                  {{ booking.specialization }}
                </p>
              }
            </div>
          }
        </div>
      }

      <!-- Mostrato se non ci sono allenamenti prenotati -->
      @if (!isLoading && upcomingBookings.length === 0) {
        <div class="empty-state">
          <p>Non hai allenamenti programmati</p>
          <ion-button expand="block" class="view-all" (click)="viewAllTrainers()">
            Prenota uno slot da un trainer
          </ion-button>
        </div>
      }

      @if (!isLoading && upcomingBookings.length > 0) {
        <ion-button expand="block" fill="clear" class="view-all" (click)="viewAllBookings()">
          Tutti gli allenamenti
        </ion-button>
      }

    </ion-card-content>

  </ion-card>

  <!-- Sezione trainers disponibili -->
  <ion-card class="ion-card-dashboard">

    <ion-card-header>
      <ion-card-title>
        <ion-icon name="fitness-outline"></ion-icon>
        Trainers Disponibili
      </ion-card-title>
    </ion-card-header>

    <ion-card-content>
      @if (isLoading) {
        <div class="loading-placeholder">
          <app-loading-spinner [message]="'Caricamento dashboard...'"></app-loading-spinner>
        </div>
      }

      <!-- Mostrato se ci sono trainers disponibili -->
      @if (!isLoading && trainers && trainers.length > 0) {
        <div class="booking-container short">
          @for (trainer of trainers.slice(0, 6); track trainer.id) {
            <div class="booking-item">
              <h2>{{ trainer.full_name }}</h2>
              <p>
                <ion-icon name="fitness-outline"></ion-icon>
                {{ trainer.specialization }}
              </p>
              <p>
                <ion-icon name="star-outline"></ion-icon>
                {{ trainer.avg_rating ? (trainer.avg_rating | number:'1.1-1') : 'N/D' }}
              </p>
            </div>
          }
        </div>
      }

      <!-- Mostrato se non ci sono trainers disponibili -->
      @if (!isLoading && (!trainers || trainers.length === 0)) {
        <div class="empty-state">
          <p>Nessun trainer disponibile</p>
        </div>
      }
      
      <ion-button expand="block" class="view-all" (click)="viewAllTrainers()">
          Sfoglia tutti i trainers
      </ion-button>

    </ion-card-content>

  </ion-card>

</ion-content>
