<app-header 
  title="Profilo"
  [backHref]="'trainer/dashboard'">
</app-header>

<ion-content [fullscreen]="true" class="ion-padding">

  <app-loading-spinner 
    *ngIf="isLoading" 
    [message]="'Caricamento...'">
  </app-loading-spinner>

  <div *ngIf="error" class="error-container">
    <ion-card class="profile-card app-card secondary-border" color="danger">
      <ion-card-content>{{ error }}</ion-card-content>
    </ion-card>
    <ion-button expand="block" (click)="loadUserData()">Riprova</ion-button>
  </div>

  <div *ngIf="!isLoading && !error">

    <!-- Sezione profilo -->
    <ion-card class="profile-card app-card secondary-border">

      <!-- Avatar e nome utente -->
      <ion-card-header>
        <ion-avatar class="profile-avatar">
          <ion-icon name="person-circle-outline" size="large"></ion-icon>
        </ion-avatar>
        <ion-card-title class="ion-text-center">{{ userData?.full_name || userData?.username || 'Utente' }}</ion-card-title>
        <div class="ion-text-center role-badge">Trainer</div>
      </ion-card-header>

      <ion-card-content>

        <ion-list lines="none">

          <!-- Email -->
           <detail-card 
            icon="person-circle-outline"
            title="Username" 
            description="{{ userData?.username || 'Non disponibile' }}">
          </detail-card>

          <!-- N. telefono -->
          <detail-card 
            icon="mail-outline"
            title="Email" 
            description="{{ userData?.email || 'Non disponibile' }}">
          </detail-card>

          <!-- Specializzazione -->
          <detail-card 
            icon="fitness-outline"
            title="Specializzazione" 
            description="{{ trainerData?.trainer_info?.specialization || userData?.specialization || 'Non disponibile' }}">
          </detail-card>

        </ion-list>
      </ion-card-content>
    </ion-card>


    <!-- Component empty state per quando non ci sono recensioni -->
    <app-empty-state 
      *ngIf="trainerData.ratings.length === 0"
      icon="time-outline"
      title="Nessuna recensione"
      description="Le tue recensioni saranno visualizzate qui">
    </app-empty-state>

    <!-- Mostrato se ci sono recensioni -->
    <div *ngIf="trainerData.ratings.length > 0">
      <ion-card class="profile-card app-card secondary-border" *ngIf="trainerData && trainerData.ratings">
        <ion-card-header>
          <ion-card-title>
            <ion-icon name="star-outline" color="danger"></ion-icon>
            Le tue recensioni
          </ion-card-title>
        </ion-card-header>

        <ion-card-content>

          <!-- Lista delle recensioni -->
          <div *ngIf="trainerData.ratings && trainerData.ratings.length > 0" class="reviews-list custom-scrollbar">
            <div class="review-card" *ngFor="let review of trainerData.ratings">
              <div class="review-header">
                <div class="customer-name"><strong>DA:</strong> {{ review.customer_name }}</div>
                <div class="review-date">{{ formatDate(review.date) }}</div>
              </div>
              
              <div class="rating">
                <div class="stars">
                  <ion-icon *ngFor="let star of generateStars(review.rating)" 
                            [name]="star.filled ? 'star' : 'star-outline'" 
                            color="warning">
                  </ion-icon>
                </div>
                <span class="rating-text"><strong>Rating:</strong> {{ review.rating }}/5</span>
              </div>
              
              <div class="review-comment" *ngIf="review.review">
                <p><strong>Review:</strong> {{ review.review }}</p>
              </div>
            </div>
          </div>
        </ion-card-content>
      </ion-card>
    </div>

  </div>
</ion-content>
