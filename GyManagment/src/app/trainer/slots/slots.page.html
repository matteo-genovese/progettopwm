<ion-header>
  <ion-toolbar>
    <ion-title>Slots</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <ion-card class="create-slot-card">
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="add-circle-outline" color="primary" style="margin-right:8px;"></ion-icon>
        Crea nuovo slot
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <form (ngSubmit)="addSlot()">
        <div class="slot-fields-row-centered">
          <div class="slot-date-group">
            <label class="slot-label">
              <ion-icon name="calendar-outline" color="primary"></ion-icon>
              Data slot
            </label>
            <ion-datetime
              class="minimal-calendar"
              presentation="date"
              [(ngModel)]="slotDate"
              name="slotDate"
              required
              [min]="minDate"
              locale="it-IT"
              showAdjacentDays="true"
              firstDayOfWeek="1">
            </ion-datetime>
            
            <!-- Orario inizio -->
            <div class="time-field">
              <div class="time-label">Orario Inizio:</div>
              <div class="time-value" (click)="openStartTimePicker()">
                {{ formatTime(startTime) }}
              </div>
            </div>
            
            <!-- Orario fine -->
            <div class="time-field">
              <div class="time-label">Orario Fine:</div>
              <div class="time-value" (click)="openEndTimePicker()">
                {{ formatTime(endTime) }}
              </div>
            </div>
          </div>
        </div>
        
        <ion-item lines="none" class="max-clienti-item">
          <ion-icon name="people-outline" slot="start" color="tertiary"></ion-icon>
          <ion-label position="stacked">Max clienti</ion-label>
          <ion-input
            type="number"
            [(ngModel)]="newSlot.max_clients"
            name="max_clients"
            min="1"
            required>
          </ion-input>
        </ion-item>
        
        <ion-button expand="block" type="submit" [disabled]="isLoading">
          <ion-icon name="add-outline" slot="start"></ion-icon>
          Aggiungi slot
        </ion-button>
      </form>
    </ion-card-content>
  </ion-card>

  <div *ngIf="isLoading" class="loading-container ion-text-center">
    <ion-spinner name="crescent"></ion-spinner>
    <p>Caricamento slot...</p>
  </div>

  <ion-card *ngIf="error" color="danger">
    <ion-card-content>
      <p>{{ error }}</p>
    </ion-card-content>
  </ion-card>
  
  <!-- Popup per selezionare l'orario di inizio -->
  <ion-modal 
    [isOpen]="showStartTimePicker" 
    [backdropDismiss]="true"
    (didDismiss)="onTimePickerDismiss('start')"
    class="time-picker-modal">
    <ng-template>
      <div class="time-picker-container">
        <ion-datetime
          presentation="time"
          [(ngModel)]="startTimePicker"
          locale="it-IT"
          hourCycle="h23"
          timezone="Europe/Rome"
          class="centered-time-picker"
          preferWheel="true">
        </ion-datetime>
        <div class="time-picker-footer">
          <ion-button fill="clear" (click)="closeStartTimePicker()">Conferma</ion-button>
        </div>
      </div>
    </ng-template>
  </ion-modal>
  
  <!-- Popup per selezionare l'orario di fine -->
  <ion-modal 
    [isOpen]="showEndTimePicker" 
    [backdropDismiss]="true"
    (didDismiss)="onTimePickerDismiss('end')"
    class="time-picker-modal">
    <ng-template>
      <div class="time-picker-container">
        <ion-datetime
          presentation="time"
          [(ngModel)]="endTimePicker"
          locale="it-IT"
          hourCycle="h23"
          timezone="Europe/Rome"
          class="centered-time-picker"
          preferWheel="true">
        </ion-datetime>
        <div class="time-picker-footer">
          <ion-button fill="clear" (click)="closeEndTimePicker()">Conferma</ion-button>
        </div>
      </div>
    </ng-template>
  </ion-modal>
</ion-content>